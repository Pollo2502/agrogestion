<!DOCTYPE html>
{% load static %}
<html lang="es">
<head>
  <meta charset="utf-8">
  <title>Portada - {{ orden.numero|default:orden.id }}</title>
  <style>
    /* Estilos simples compatibles con xhtml2pdf */
    body { font-family: Arial, Helvetica, sans-serif; font-size:12px; color:#222; margin:20px; }
    h1 { font-size:18px; margin:0 0 6px 0; }
    h2 { font-size:14px; margin:6px 0 12px 0; font-weight:normal; color:#444; }
    .section { margin-bottom:12px; }
    table { width:100%; border-collapse:collapse; }
    .box { border:1px solid #000; padding:8px; margin-bottom:8px; }

    /* Meta table: líneas en negro y estructura tipo cuadricula */
    .meta-table th, .meta-table td { vertical-align:top; padding:8px; border:1px solid #000; }
    .meta-table th { background:#f6f6f6; font-weight:700; text-align:left; }
    .label { font-weight:700; width:30%; }
    .value { width:70%; }

    /* Tabla para proveedor / monto / IVA (ejemplo) */
    .provider-table th, .provider-table td { padding:8px; border:1px solid #000; text-align:left; }
    .provider-table th { background:#efefef; }

    .muted { color:#666; font-size:11px; }
    .firma { margin-top:18px; }
    .firma img { max-width:260px; max-height:80px; border:1px solid #000; padding:4px; background:#fff; display:block; }
    .footer { margin-top:18px; font-size:11px; color:#666; text-align:center; }
    pre { white-space:pre-wrap; font-family:inherit; font-size:12px; }
  </style>
</head>
<body>
  <div class="header" style="margin-bottom:12px; display:flex; align-items:center; gap:12px;">
    <div class="logo" style="flex:0 0 auto;">
      <img src="{% static 'images/logo.png' %}" alt="Logo" style="max-width:120px; max-height:90px;" />
    </div>
    <div style="flex:1 1 auto;">
      <h1 style="margin:0;">Portada de Expediente</h1>
      <h2 style="margin:4px 0 0 0;">Orden de Compra: {{ orden.numero|default:orden.id }}</h2>
    </div>
  </div>

  <div class="section box">
    <table class="meta-table">
      <tr>
        <td class="label">Nº Solicitud</td>
        <td class="value">{{ solicitud.id|default:"-" }}</td>
      </tr>
      <tr>
        <td class="label">Fecha de envío</td>
        <td class="value">{% if solicitud.fecha_envio %}{{ solicitud.fecha_envio|date:"d/m/Y H:i" }}{% else %}-{% endif %}</td>
      </tr>
      <tr>
        <td class="label">Estado</td>
        <td class="value">{{ solicitud.get_estado_display|default:"-" }}</td>
      </tr>
      <tr>
        <td class="label">Nº Orden</td>
        <td class="value">{% if orden.numero %}{{ orden.numero }}{% else %}{{ orden.id }}{% endif %}</td>
      </tr>
      <tr>
        <td class="label">Descripción Orden</td>
        <td class="value">{% if orden.descripcion %}{{ orden.descripcion }}{% else %}-{% endif %}</td>
      </tr>
    </table>
  </div>

  <div class="section box">
    <table class="meta-table">
      <tr>
        <td class="label">Requisición</td>
        <td class="value">{{ requisicion.codigo|default:"-" }}</td>
      </tr>
      <tr>
        <td class="label">Solicitante</td>
        <td class="value">{% if requisicion.usuario %}{{ requisicion.usuario.nombre }}{% else %}-{% endif %}</td>
      </tr>
      <tr>
        <td class="label">Fecha Requerida</td>
        <td class="value">{% if requisicion.fecha_requerida %}{{ requisicion.fecha_requerida|date:"d/m/Y" }}{% else %}-{% endif %}</td>
      </tr>
      <tr>
        <td class="label">Importancia</td>
        <td class="value">{% if requisicion.importancia == 'U' %}Urgente{% else %}Normal{% endif %}</td>
      </tr>
    </table>
  </div>

  <div class="section box">
    <table class="meta-table">
      <tr>
        <td class="label">Número Orden Compra</td>
        <td class="value">{% if orden.numero %}{{ orden.numero }}{% else %}{{ orden.id }}{% endif %}</td>
      </tr>
      <tr>
        <td class="label">Moneda</td>
        <td class="value">Dólares</td>
      </tr>
      <tr>
        <td class="label">Descripción</td>
        <td class="value">{% if orden.descripcion %}{{ orden.descripcion }}{% elif requisicion.descripcion %}{{ requisicion.descripcion }}{% else %}-{% endif %}</td>
      </tr>
    </table>
  </div>

  <!-- Tabla de ejemplo: Proveedor / Monto / IVA (añadida en HTML como muestra) -->
  <div class="section box">
    <div style="margin-bottom:8px; font-weight:700;">Resumen financiero (ejemplo)</div>
    <table class="provider-table" role="table">
      <thead>
        <tr>
          <th>Proveedor</th>
          <th>Monto</th>
          <th>IVA</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td>Proveedor Ejemplo S.A.</td>
          <td>1,000.00</td>
          <td>160.00</td>
        </tr>
      </tbody>
    </table>
    <div class="muted" style="margin-top:6px;">Valores de ejemplo — posteriormente se rellenarán desde el backend</div>
  </div>

  {% if orden.proveedor %}
  <div class="section box">
    <table class="meta-table">
      <tr>
        <td class="label">Proveedor</td>
        <td class="value">{{ orden.proveedor.nombre|default:orden.proveedor }}</td>
      </tr>
      <tr>
        <td class="label">RIF / ID</td>
        <td class="value">{{ orden.proveedor.rif|default:"-" }}</td>
      </tr>
      <tr>
        <td class="label">Banco / Cuenta</td>
        <td class="value">
          {% if orden.proveedor.banco %}{{ orden.proveedor.banco }}{% endif %}
          {% if orden.proveedor.cuenta_bancaria %} — {{ orden.proveedor.cuenta_bancaria }}{% endif %}
          {% if not orden.proveedor.banco and not orden.proveedor.cuenta_bancaria %}-{% endif %}
        </td>
      </tr>
    </table>
  </div>
  {% endif %}

  <div class="firma">
    <div><strong>Generado y verificado por</strong></div>
    <div style="margin-top:6px;">
      <div>{{ user.nombre|default:user.nombre_completo|default:"Usuario" }} — Contabilidad</div>
      {% if user.firma %}
        <img src="{{ user.firma.url }}" alt="Firma de {{ user.nombre }}">
      {% else %}
        <div class="muted">Sin firma registrada</div>
      {% endif %}
    </div>
  </div>

  <div class="footer">
    Generado por Agrogestión — {{ user.nombre|default:"Sistema" }}{% if now %} — {{ now|date:"d/m/Y H:i" }}{% endif %}
  </div>
</body>
</html>

